<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Smart Airline Booking</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <nav>
    <a href="{{ url_for('index') }}">Home</a>
    <a href="{{ url_for('dashboard') }}">Dashboard</a>
    <a href="{{ url_for('my_bookings') }}">My Bookings</a>
    <a href="{{ url_for('admin') }}">Admin</a>
    <a href="#">Logout</a>
  </nav>

    <div class="container">
        <h2>Available Flights</h2>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form action="{{ url_for('dashboard') }}" method="GET" class="search-form">
            <input type="text" name="source" placeholder="Source" value="{{ request.args.get('source', '') }}">
            <input type="text" name="destination" placeholder="Destination" value="{{ request.args.get('destination', '') }}">
            <input type="date" name="date" value="{{ request.args.get('date', '') }}">
            <select name="sort_by">
                <option value="">Sort By</option>
                <option value="price" {% if request.args.get('sort_by') == 'price' %}selected{% endif %}>Lowest Price</option>
                <option value="time" {% if request.args.get('sort_by') == 'time' %}selected{% endif %}>Earliest Time</option>
                <option value="seats" {% if request.args.get('sort_by') == 'seats' %}selected{% endif %}>Most Seats</option>
            </select>
            <button type="submit">Search</button>
            <a href="{{ url_for('dashboard') }}" class="reset-btn">Reset</a>
        </form>

        <table id="flightsTable">
      <thead>
        <tr>
          <th>Flight No.</th>
          <th>Source</th>
          <th>Destination</th>
          <th>Date</th>
          <th>Time</th>
          <th>Seats Available</th>
          <th>Price (₹)</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for flight in flights %}
            <tr>
                <td>{{ flight.flight_id }}</td>
                <td>{{ flight.source }}</td>
                <td>{{ flight.destination }}</td>
                <td>{{ flight.date.strftime('%Y-%m-%d') }}</td>
                <td>{{ flight.date.strftime('%H:%M') }}</td>
                <td>{{ flight.available_seats }}</td>
                <td>{{ flight.price }}</td>
                <td>
                    <a href="{{ url_for('book_flight', flight_id=flight.flight_id) }}">
                        <button>Book</button>
                    </a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="8">No flights available at this time.</td>
            </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

<script>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                Swal.fire({
                    title: '{{ "Booking Successful!" if category == "success" else "Booking Failed!" }}',
                    text: '{{ message }}',
                    icon: '{{ category }}', // 'success' or 'error'
                    confirmButtonText: 'OK',
                    showCancelButton: true,
                    cancelButtonText: 'View My Bookings'
                }).then((result) => {
                    if (result.isDismissed && result.dismiss === Swal.DismissReason.cancel) {
                        // If "View My Bookings" is clicked, redirect
                        window.location.href = "{{ url_for('my_bookings') }}";
                    }
                });
                {% endfor %}
        {% endif %}
    {% endwith %}
    
</script>
</body>
</html>